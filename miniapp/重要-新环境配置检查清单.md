# 重要：新环境配置检查清单

## 🔴 当前问题

调用云函数时仍然报权限错误：`-601034 没有权限，请先开通云开发或者云托管`

## ✅ 已完成的修改

1. ✅ 创建新云开发环境：`cloud1-2gmpataie7b260ad`
2. ✅ 更新 `app.js` 中的环境ID
3. ✅ 更新 `utils/db.js` 中的环境ID
4. ✅ 将登录代码改回直接使用数据库（不再使用云函数）

## 🚀 现在需要做的

### 第一步：在微信开发者工具中开通云开发（关键！）

虽然创建了新环境，但**仍然需要在微信开发者工具中开通云开发**：

1. **在微信开发者工具中，点击右上角"详情"按钮**
2. **查看是否有"云开发"相关选项出现**
3. **或者查看"工具"菜单，是否有"云开发"选项**
4. **如果找到了，点击开通**
5. **关联新环境**：`cloud1-2gmpataie7b260ad`

### 第二步：在云开发控制台创建数据库集合

1. **访问云开发控制台**：https://console.cloud.tencent.com/tcb
2. **选择新环境**：`cloud1-2gmpataie7b260ad`
3. **点击左侧菜单的"数据库"**
4. **创建以下4个集合**（如果不存在）：
   - `users` - 用户表
   - `activities` - 活动表
   - `bills` - 账单表
   - `groups` - 分组表
5. **为每个集合设置权限**：
   - 点击集合名称 → "权限设置"
   - 选择"所有用户可读，仅创建者可写"（或"所有用户可读写"用于测试）
   - 保存

### 第三步：重新测试

1. **在微信开发者工具中，点击"编译"按钮**
2. **测试登录功能**
3. **如果成功，应该不会再报权限错误**

---

## 💡 如果仍然报错

如果直接使用数据库仍然报权限错误，说明：

1. **小程序AppID没有在新环境中授权**
2. **必须在微信开发者工具中开通云开发**

这是解决问题的关键步骤！

---

## 📋 请告诉我

1. **在微信开发者工具中，是否找到了"云开发"选项？**
2. **是否已经在云开发控制台创建了数据库集合？**
3. **重新测试登录功能，结果如何？**

