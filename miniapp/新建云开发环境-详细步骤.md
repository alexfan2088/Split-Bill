# 新建云开发环境 - 详细步骤

## 🎯 方案说明

如果无法授权现有环境，可以创建一个新的云开发环境，然后在微信开发者工具中开通云开发并关联这个新环境。

**注意**：新环境的数据不会和Web版本共享。你可以选择：
1. 让小程序使用新环境（数据独立）
2. 或者后续将Web版本也迁移到新环境（数据统一）

---

## ✅ 步骤一：在云开发控制台创建新环境

### 1.1 访问云开发控制台

1. **打开浏览器**
2. **访问**：https://console.cloud.tencent.com/tcb
3. **登录你的腾讯云账号**

### 1.2 创建新环境

1. **在控制台顶部，点击"新建环境"或"+"按钮**
2. **填写环境信息**：
   - **环境名称**：例如 `miniapp-env` 或 `小程序环境`
   - **环境ID**：系统会自动生成（例如：`cloud1-xxxxx`）
   - **套餐类型**：选择"免费版"（Free Tier）
3. **点击"创建"**
4. **等待创建完成**（通常几秒钟）

### 1.3 记录新环境ID

创建完成后，**复制新环境ID**（例如：`cloud1-xxxxx`），稍后会用到。

---

## ✅ 步骤二：在微信开发者工具中开通云开发

### 2.1 尝试开通云开发

创建新环境后，在微信开发者工具中：

1. **点击右上角"详情"按钮**
2. **查看是否有"云开发"相关选项出现**
3. **或者查看"工具"菜单，是否有"云开发"选项**

### 2.2 如果还是找不到

可能需要：

1. **在微信开发者工具中，点击"新建项目"**
2. **选择"小程序"**
3. **勾选"云开发"选项**（如果有）
4. **创建项目后，关联刚才创建的新环境**

---

## ✅ 步骤三：更新小程序代码中的环境ID

### 3.1 修改 app.js

1. **打开 `miniapp/app.js` 文件**
2. **找到这一行**：
   ```javascript
   env: 'cloud1-0g37deo4d3db8310',
   ```
3. **替换为新环境ID**：
   ```javascript
   env: 'cloud1-xxxxx', // 替换为你的新环境ID
   ```

### 3.2 修改云函数（如果使用）

如果使用云函数，也需要更新：

1. **打开 `miniapp/cloudfunctions/login/index.js`**
2. **确认使用 `cloud.DYNAMIC_CURRENT_ENV`**（这样会自动使用app.js中的环境）

---

## ✅ 步骤四：创建数据库集合

在新环境中，需要创建数据库集合：

1. **在云开发控制台，选择新环境**
2. **点击左侧菜单的"数据库"**
3. **创建以下集合**：
   - `users`
   - `activities`
   - `bills`
   - `groups`
4. **为每个集合设置权限**：
   - 点击集合名称
   - 点击"权限设置"
   - 选择"所有用户可读，仅创建者可写"或"所有用户可读写"（用于测试）

---

## ✅ 步骤五：部署云函数（如果使用）

1. **在微信开发者工具中，找到 `cloudfunctions/login` 文件夹**
2. **右键点击，选择"上传并部署：云端安装依赖"**
3. **等待上传完成**

---

## ✅ 步骤六：测试

1. **在微信开发者工具中，重新编译**
2. **测试登录功能**
3. **如果成功，应该不会再报权限错误**

---

## 💡 关于数据共享

### 方案A：数据独立（简单）

- **Web版本**：继续使用旧环境 `cloud1-0g37deo4d3db8310`
- **小程序版本**：使用新环境
- **优点**：简单，不需要迁移数据
- **缺点**：两个版本的数据不共享

### 方案B：数据统一（推荐，但需要迁移）

- **两个版本都使用新环境**
- **需要将旧环境的数据迁移到新环境**
- **优点**：数据统一，用户体验一致
- **缺点**：需要迁移数据

---

## 🚀 现在请做这些

1. **访问云开发控制台**：https://console.cloud.tencent.com/tcb
2. **创建新环境**（选择免费版）
3. **记录新环境ID**
4. **告诉我新环境ID是什么？**

然后我会帮你更新代码！

