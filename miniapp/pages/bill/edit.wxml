<!--pages/bill/edit.wxml-->
<view class="container">
  <view class="form">
    <view class="form-item">
      <text class="label">金额（元）</text>
      <input class="input" type="digit" placeholder="0.00" value="{{amount}}" bindinput="onAmountInput" disabled="{{isReadOnly}}" />
    </view>
    
    <view class="form-item">
      <text class="label">账单类型</text>
      <view class="type-tags">
        <view wx:for="{{commonTypes}}" wx:key="*this" class="type-tag {{billType === item ? 'active' : ''}}" bindtap="selectBillType" data-type="{{item}}">
          {{item}}
        </view>
      </view>
      <input class="input" type="text" placeholder="或输入自定义类型" value="{{billType}}" bindinput="onBillTypeInput" bindblur="onBillTypeBlur" maxlength="10" disabled="{{isReadOnly}}" />
    </view>
    
    <view class="form-item">
      <text class="label">账单名称</text>
      <input class="input" type="text" placeholder="例如：晚餐、山姆购物" value="{{title}}" bindinput="onTitleInput" maxlength="20" disabled="{{isReadOnly}}" />
      <view wx:if="{{!isReadOnly && !isEdit && recentBillTitles.length > 0}}" class="recent-titles">
        <view class="recent-titles-label">最近账单名称：</view>
        <view class="recent-titles-buttons">
          <view wx:for="{{recentBillTitles}}" wx:key="*this" class="btn-title-item" bindtap="selectTitle" data-title="{{item}}">{{item}}</view>
          <view class="btn-title-clear" bindtap="clearTitle">清空</view>
        </view>
      </view>
      <text class="hint">最多20个汉字</text>
    </view>
    
    <view class="form-item">
      <text class="label">时间</text>
      <picker mode="date" value="{{date}}" bindchange="onDateChange" disabled="{{isReadOnly}}">
        <view class="picker">{{date || '选择日期'}}</view>
      </picker>
      <picker mode="time" value="{{time}}" bindchange="onTimeChange" disabled="{{isReadOnly}}">
        <view class="picker">{{time || '选择时间'}}</view>
      </picker>
    </view>
    
    <view class="form-item">
      <view class="form-item-header">
        <text class="label">付款人</text>
        <view class="form-actions">
          <button wx:if="{{!isReadOnly}}" class="btn btn-save" bindtap="saveBill">{{isEdit ? '更新账单' : '保存账单'}}</button>
          <button wx:if="{{isEdit && isCreator && !isReadOnly}}" class="btn btn-delete" bindtap="deleteBill">删除</button>
        </view>
      </view>
      <picker range="{{payerList}}" range-key="name" value="{{payerIndex}}" bindchange="onPayerChange" disabled="{{isReadOnly || payerDisabled}}">
        <view class="picker {{payerDisabled ? 'picker-disabled' : ''}}">{{payerList[payerIndex] ? payerList[payerIndex].name : '选择付款人'}}</view>
      </picker>
      <view wx:if="{{isPrepaid && keeper}}" class="hint">预存活动，默认付款人为保管人员（{{keeper}}），可选择其他人员</view>
    </view>
    
    <view class="form-item">
      <text class="label">参与成员（选择权重：0表示不参与，1-3表示人数）</text>
      <view class="participants-list">
        <view wx:for="{{participants}}" wx:key="name" class="participant-item">
          <view class="participant-name">{{item.name}}</view>
          <radio-group bindchange="onWeightChange" data-name="{{item.name}}" disabled="{{isReadOnly}}">
            <view class="weight-options">
              <view wx:for="{{[0,1,2,3]}}" wx:key="*this" wx:for-item="w" class="weight-option">
                <radio value="{{w}}" checked="{{item.weight === w}}" disabled="{{isReadOnly}}" />
                <text>{{w}}</text>
              </view>
            </view>
          </radio-group>
        </view>
      </view>
    </view>
    
    <view class="form-item">
      <text class="label">备注</text>
      <textarea class="textarea" placeholder="可选（最多20个汉字）" value="{{remark}}" bindinput="onRemarkInput" disabled="{{isReadOnly}}" auto-height="{{false}}" maxlength="20" />
    </view>
  </view>
</view>

