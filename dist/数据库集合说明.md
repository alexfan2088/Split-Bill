# 数据库集合说明

根据代码，系统需要以下数据库集合：

## 必需的集合

### 1. `users` - 用户集合
**用途**：存储注册用户信息
**字段结构**：
- `name` (String): 用户名（唯一）
- `password` (String): 加密后的密码
- `createdAt` (Date): 创建时间
- `updatedAt` (Date): 更新时间

**权限建议**：所有用户可读，仅创建者可写

---

### 2. `activities` - 活动集合
**用途**：存储活动基本信息
**字段结构**：
- `name` (String): 活动名称
- `type` (String): 活动类型
- `remark` (String): 备注
- `members` (Array): 成员数组，格式：`[{name: "用户名", active: true}]`
- `memberNames` (Array): 成员名称数组，用于快速查询
- `createdAt` (Date): 创建时间
- `updatedAt` (Date): 更新时间

**权限建议**：所有用户可读，仅创建者可写

---

### 3. `groups` - 活动群组集合 ⭐ **新增**
**用途**：存储每个活动的成员组信息（用于验证成员是否已注册）
**字段结构**：
- `activityId` (String): 关联的活动ID
- `members` (Array): 成员数组，格式：`[{name: "用户名", active: true}]`
- `createdAt` (Date): 创建时间
- `updatedAt` (Date): 更新时间

**权限建议**：所有用户可读，仅创建者可写

**注意**：这是新添加的集合，需要手动创建！

---

### 4. `bills` - 费用集合
**用途**：存储费用记录
**字段结构**：
- `activityId` (String): 关联的活动ID
- `amount` (Number): 金额
- `title` (String): 费用名称
- `category` (String): 分类
- `time` (Date): 时间
- `payer` (String): 付款人
- `participants` (Object): 参与人及权重，格式：`{"用户名": 权重(0-3)}`
- `remark` (String): 备注
- `createdAt` (Date): 创建时间
- `updatedAt` (Date): 更新时间

**权限建议**：所有用户可读，仅创建者可写

---

### 5. `customActivityTypes` - 自定义活动类型集合
**用途**：存储用户自定义的活动类型（最多5个）
**字段结构**：
- `type` (String): 自定义类型名称
- `createdAt` (Date): 创建时间

**权限建议**：所有用户可读，仅创建者可写

---

## 创建集合步骤

1. 登录 [腾讯云开发控制台](https://console.cloud.tencent.com/tcb)
2. 选择你的环境
3. 进入「数据库」页面
4. 点击「新建集合」
5. 依次创建以下集合：
   - `users`
   - `activities`
   - `groups` ⭐ **必须创建**
   - `bills`
   - `customActivityTypes`

## 注意事项

- **`groups` 集合是新添加的，必须手动创建**，否则创建活动时会报错
- 如果集合不存在，第一次写入数据时可能会自动创建，但建议手动创建并设置权限
- 所有集合的权限建议设置为：**所有用户可读，仅创建者可写**
- 如果已有旧数据，`groups` 集合会在创建/更新活动时自动创建记录

